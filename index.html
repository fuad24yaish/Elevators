<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Tender Evaluation - Vendor Documents & Weights</title>
<style>
    body { font-family: Arial, sans-serif; background: #f7f9fc; margin: 20px; color: #333; }
    h1 { text-align: center; color: #005b96; }
    h2 { margin-top: 30px; color: #004d73; }
    .vendor-section, .weights-section { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 0 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
    .vendor { margin-bottom: 20px; }
    .vendor label { display: block; font-weight: bold; margin-bottom: 5px; }
    .drop-zone { background: #eef3f7; padding: 20px; text-align: center; border: 2px dashed #bbb; border-radius: 8px; cursor: pointer; transition: background 0.3s; }
    .drop-zone.dragover { background: #d9edf7; }
    ul.file-list { list-style: none; padding: 0; margin-top: 5px; }
    ul.file-list li { background: #eef3f7; padding: 5px; margin-bottom: 3px; border-radius: 4px; font-size: 14px; display: flex; justify-content: space-between; align-items: center; }
    .remove-btn { background: red; color: white; border: none; border-radius: 3px; cursor: pointer; font-size: 12px; padding: 2px 6px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    th { background: #e8f1fa; }
    input[type="number"] { width: 60px; padding: 5px; text-align: center; }
    .total { font-weight: bold; background: #f1f8e9; }
    .warning { color: red; font-weight: bold; display: none; }
    button { padding: 8px 15px; margin-top: 10px; background: #005b96; color: white; border: none; border-radius: 4px; cursor: pointer; }
    /* Processing Overlay */
    #processingOverlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(247, 249, 252, 0.95); z-index: 9999; text-align: center; padding-top: 100px; }
    .progress-container { width: 60%; margin: auto; background: #ddd; border-radius: 20px; overflow: hidden; }
    .progress-bar { height: 25px; width: 0%; background: #4caf50; text-align: center; color: white; line-height: 25px; font-weight: bold; }
    .vendor-status { margin-top: 20px; font-size: 18px; }
    .vendor-status span { display: block; margin: 5px; }
</style>
<script>
function saveToLocalStorage(vendorId, files) {
    localStorage.setItem(vendorId, JSON.stringify(files));
}

function loadFromLocalStorage(vendorId) {
    return JSON.parse(localStorage.getItem(vendorId)) || [];
}

function renderFileList(vendorId) {
    const fileList = document.getElementById(vendorId + "-list");
    fileList.innerHTML = "";
    const files = loadFromLocalStorage(vendorId);
    files.forEach((file, index) => {
        const li = document.createElement("li");
        li.textContent = file;
        const removeBtn = document.createElement("button");
        removeBtn.textContent = "Remove";
        removeBtn.className = "remove-btn";
        removeBtn.onclick = () => {
            files.splice(index, 1);
            saveToLocalStorage(vendorId, files);
            renderFileList(vendorId);
        };
        li.appendChild(removeBtn);
        fileList.appendChild(li);
    });
}

function handleFileUpload(files, vendorId) {
    const existingFiles = loadFromLocalStorage(vendorId);
    files.forEach(file => {
        if (!existingFiles.includes(file.name)) {
            existingFiles.push(file.name);
        }
    });
    saveToLocalStorage(vendorId, existingFiles);
    renderFileList(vendorId);
}

function setupDropZone(vendorId) {
    const dropZone = document.getElementById(vendorId + "-dropzone");
    dropZone.addEventListener("click", () => {
        document.getElementById(vendorId + "-file").click();
    });
    dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("dragover");
    });
    dropZone.addEventListener("dragleave", () => {
        dropZone.classList.remove("dragover");
    });
    dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("dragover");
        handleFileUpload(Array.from(e.dataTransfer.files), vendorId);
    });
}

function validateWeights() {
    let total = 0;
    document.querySelectorAll(".weight-input").forEach(input => {
        let value = parseInt(input.value) || 0;
        if (value < 10) input.value = 10;
        if (value > 50) input.value = 50;
        total += parseInt(input.value);
    });
    document.getElementById("totalWeight").innerText = total + "%";
    document.getElementById("warning").style.display = (total !== 100) ? "block" : "none";
}

function saveSettingsAndGoToReport() {
    // Save weights
    const weights = {};
    document.querySelectorAll(".weight-input").forEach(input => {
        const aspect = input.closest("tr").children[0].innerText.trim();
        weights[aspect] = parseInt(input.value) || 0;
    });
    localStorage.setItem("weights", JSON.stringify(weights));

    // Show processing overlay
    document.getElementById("processingOverlay").style.display = "block";
    processVendors();
}

function processVendors() {
    const vendors = ["Vendor A", "Vendor B", "Vendor C"];
    let currentVendor = 0;
    let progress = 0;

    function updateProgress() {
        progress += 5;
        if (progress > 100) progress = 100;
        document.querySelector(".progress-bar").style.width = progress + "%";
        document.querySelector(".progress-bar").innerText = progress + "%";
    }

    function processNextVendor() {
        if (currentVendor < vendors.length) {
            document.getElementById("vendorStatusText").innerText = `Evaluating ${vendors[currentVendor]}...`;
            let steps = 0;
            let vendorInterval = setInterval(() => {
                updateProgress();
                steps++;
                if (steps >= 20) { // simulate ~2s per vendor
                    clearInterval(vendorInterval);
                    currentVendor++;
                    processNextVendor();
                }
            }, 100);
        } else {
            setTimeout(() => {
                window.location.href = "report.html";
            }, 500);
        }
    }

    processNextVendor();
}

window.onload = function() {
    ["vendorA", "vendorB", "vendorC"].forEach(vendorId => {
        setupDropZone(vendorId);
        renderFileList(vendorId);
    });
    validateWeights();
}
</script>
</head>
<body>

<h1>üìÇ Tender Evaluation - Document Upload & Weights</h1>

<!-- Vendor Document Upload -->
<div class="vendor-section">
    <h2>1Ô∏è‚É£ Upload Vendor Documents</h2>
    
    <div class="vendor">
        <label>Vendor A Documents:</label>
        <div id="vendorA-dropzone" class="drop-zone">üìÅ Drag & Drop files here or click to upload</div>
        <input type="file" id="vendorA-file" multiple style="display:none" onchange="handleFileUpload(Array.from(this.files), 'vendorA')">
        <ul id="vendorA-list" class="file-list"></ul>
    </div>
    
    <div class="vendor">
        <label>Vendor B Documents:</label>
        <div id="vendorB-dropzone" class="drop-zone">üìÅ Drag & Drop files here or click to upload</div>
        <input type="file" id="vendorB-file" multiple style="display:none" onchange="handleFileUpload(Array.from(this.files), 'vendorB')">
        <ul id="vendorB-list" class="file-list"></ul>
    </div>
    
    <div class="vendor">
        <label>Vendor C Documents:</label>
        <div id="vendorC-dropzone" class="drop-zone">üìÅ Drag & Drop files here or click to upload</div>
        <input type="file" id="vendorC-file" multiple style="display:none" onchange="handleFileUpload(Array.from(this.files), 'vendorC')">
        <ul id="vendorC-list" class="file-list"></ul>
    </div>
</div>

<!-- Weights Table -->
<div class="weights-section">
    <h2>2Ô∏è‚É£ Adjust Evaluation Weights</h2>
    <p>Set weights between 10% and 50% for each aspect. Total must equal 100%.</p>

    <table>
        <thead>
            <tr>
                <th>Main Aspect</th>
                <th>Weight (%)</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>Technical Compliance</td>
                <td><input type="number" class="weight-input" value="30" min="10" max="50" onchange="validateWeights()">%</td>
            </tr>
            <tr>
                <td>Safety & Reliability</td>
                <td><input type="number" class="weight-input" value="20" min="10" max="50" onchange="validateWeights()">%</td>
            </tr>
            <tr>
                <td>Vendor Capability</td>
                <td><input type="number" class="weight-input" value="15" min="10" max="50" onchange="validateWeights()">%</td>
            </tr>
            <tr>
                <td>Maintenance & Lifecycle</td>
                <td><input type="number" class="weight-input" value="15" min="10" max="50" onchange="validateWeights()">%</td>
            </tr>
            <tr>
                <td>Commercial Terms</td>
                <td><input type="number" class="weight-input" value="10" min="10" max="50" onchange="validateWeights()">%</td>
            </tr>
            <tr>
                <td>Energy Efficiency & Sustainability</td>
                <td><input type="number" class="weight-input" value="10" min="10" max="50" onchange="validateWeights()">%</td>
            </tr>
            <tr class="total">
                <td>Total</td>
                <td id="totalWeight">100%</td>
            </tr>
        </tbody>
    </table>
    <p id="warning" class="warning">‚ö†Ô∏è The total weight must equal 100%!</p>
</div>

<!-- Submit -->
<div style="text-align:center;">
    <button onclick="saveSettingsAndGoToReport()">Save Settings</button>
</div>

<!-- Processing Overlay -->
<div id="processingOverlay">
    <h2>Processing Documents & Evaluating Vendors...</h2>
    <div class="progress-container">
        <div class="progress-bar">0%</div>
    </div>
    <div id="vendorStatusText" class="vendor-status"></div>
</div>

</body>
</html>
